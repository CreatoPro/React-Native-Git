{"version":3,"sources":["index.tsx"],"names":["React","View","StyleSheet","InfiniteLoader","VariableSizeList","VariableSizeGrid","outerElementTypeWithTestId","testID","forwardRef","props","ref","FlatList","outerRef","useRef","undefined","ListHeaderComponent","ListHeaderComponentStyle","numColumns","maxToRenderPerBatch","data","renderItem","getItemLayout","onEndReached","inverted","onEndReachedThreshold","Error","layout","setLayout","useState","width","height","useEffect","current","listener","e","preventDefault","reverse","directionInvertedFromDevice","webkitDirectionInvertedFromDevice","navigator","platform","indexOf","scrollTop","deltaY","addEventListener","passive","removeEventListener","Grid","columnIndex","rowIndex","style","index","transform","length","item","Row","getItemSize","layoutHeight","marginTop","marginBottom","paddingTop","paddingBottom","flatten","Number","getItemWidth","_","itemCount","isItemLoaded","onLoadMore","useCallback","stopIndex","total","totalHeight","offset","distanceFromEnd","outerElementType","useMemo","inner","onItemsRendered","Math","ceil","onLayout","nativeEvent","styles","invertedContainer","create","scale","invertedItem"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { View } from 'react-native';\nimport { FlatListProps, StyleSheet } from 'react-native';\nimport InfiniteLoader from 'react-window-infinite-loader';\nimport { VariableSizeList, VariableSizeGrid } from 'react-window';\n\nconst outerElementTypeWithTestId = (testID: string | undefined) =>\n  React.forwardRef((props, ref) => (\n    // @ts-ignore\n    <div ref={ref} data-testid={testID} {...props} />\n  ));\n\nexport default function FlatList<T>(props: FlatListProps<T>) {\n  const outerRef = React.useRef<HTMLDivElement | undefined>(undefined);\n  const {\n    ListHeaderComponent,\n    ListHeaderComponentStyle,\n    numColumns = 1,\n    maxToRenderPerBatch = 20,\n    data,\n    renderItem,\n    getItemLayout,\n    onEndReached,\n    inverted,\n    testID,\n  } = props;\n\n  const onEndReachedThreshold: number = props.onEndReachedThreshold || 15;\n\n  if (!getItemLayout) {\n    throw Error('getItemLayout is required with react-native-ridge');\n  }\n\n  const [layout, setLayout] = React.useState({ width: 0, height: 0 });\n  React.useEffect(() => {\n    if (!inverted) {\n      return;\n    }\n    const ref = outerRef.current;\n    const listener = (e: WheelEvent) => {\n      e.preventDefault();\n\n      if (ref) {\n        // only supported in safari but maybe added in the future\n        let reverse =\n          (e as any).directionInvertedFromDevice ||\n          (e as any).webkitDirectionInvertedFromDevice ||\n          (e as any).directionInvertedFromDevice;\n\n        // fallback on default settings\n        if (reverse === undefined) {\n          reverse = navigator.platform.indexOf('Mac') > -1;\n        }\n\n        if (reverse) {\n          ref.scrollTop -= e.deltaY;\n        } else {\n          ref.scrollTop += e.deltaY;\n        }\n      }\n\n      return false;\n    };\n\n    if (ref) {\n      ref.addEventListener('wheel', listener, { passive: false });\n      return () => {\n        ref.removeEventListener('wheel', listener);\n      };\n    }\n    return;\n  }, [inverted]);\n\n  const Grid = ({ columnIndex, rowIndex, style }: any) => {\n    const index = rowIndex + columnIndex;\n    return (\n      // eslint-disable-next-line react-native/no-inline-styles\n      <div style={inverted ? { ...style, transform: 'scale(-1)' } : style}>\n        {data && data.length > 0 && renderItem\n          ? renderItem({ index, item: data && data[index] } as any)\n          : null}\n      </div>\n    );\n  };\n\n  const Row = ({ index, style }: any) => (\n    // eslint-disable-next-line react-native/no-inline-styles\n    <div style={inverted ? { ...style, transform: 'scale(-1)' } : style}>\n      {index === 0\n        ? ListHeaderComponent && (\n            <View style={ListHeaderComponentStyle}>\n              {typeof ListHeaderComponent === 'function'\n                ? (ListHeaderComponent as any)()\n                : ListHeaderComponent}\n            </View>\n          )\n        : null}\n      {data && data.length > 0 && renderItem\n        ? renderItem({ index, item: data && data[index] } as any)\n        : null}\n    </div>\n  );\n\n  const getItemSize = (index: number) => {\n    const layoutHeight = getItemLayout(data as any, index).length;\n    if (index === 0 && (ListHeaderComponent || ListHeaderComponentStyle)) {\n      if (ListHeaderComponentStyle) {\n        const { marginTop, marginBottom, paddingTop, paddingBottom, height } =\n          StyleSheet.flatten(ListHeaderComponentStyle);\n        return (\n          layoutHeight +\n          (Number(marginTop) || 0) +\n          (Number(marginBottom) || 0) +\n          (Number(paddingTop) || 0) +\n          (Number(paddingBottom) || 0) +\n          (Number(height) || 0)\n        );\n      }\n      // to add support for header\n      if (ListHeaderComponent) {\n        return layoutHeight * 2;\n      }\n    }\n    return layoutHeight;\n  };\n  const getItemWidth = (_: number) => {\n    return layout.width / numColumns;\n  };\n  const itemCount = data && data.length > 0 ? data.length : 1; // to add support for header\n\n  const isItemLoaded = (index: number) => index < itemCount;\n\n  const onLoadMore = React.useCallback(\n    (_: number, stopIndex: number) => {\n      const total = getItemLayout(data as any, (data as any).length - 1);\n      const totalHeight = total.offset + total.length;\n      const offset = getItemLayout(data as any, stopIndex).offset;\n      onEndReached?.({\n        distanceFromEnd: totalHeight - offset,\n      });\n      return null;\n    },\n    [data, getItemLayout, onEndReached]\n  );\n\n  const outerElementType = React.useMemo(\n    () => outerElementTypeWithTestId(testID),\n    [testID]\n  );\n\n  let inner;\n  if (numColumns > 1) {\n    inner = (\n      <InfiniteLoader\n        isItemLoaded={isItemLoaded}\n        itemCount={itemCount + maxToRenderPerBatch}\n        loadMoreItems={onLoadMore}\n        minimumBatchSize={maxToRenderPerBatch}\n        threshold={onEndReachedThreshold}\n      >\n        {({ onItemsRendered, ref }) => (\n          <VariableSizeGrid\n            ref={ref}\n            outerRef={outerRef}\n            outerElementType={outerElementType}\n            onItemsRendered={onItemsRendered as any}\n            width={layout.width}\n            height={layout.height}\n            columnCount={numColumns}\n            rowHeight={getItemSize}\n            columnWidth={getItemWidth}\n            rowCount={Math.ceil(itemCount / numColumns)}\n          >\n            {Grid}\n          </VariableSizeGrid>\n        )}\n      </InfiniteLoader>\n    );\n  } else {\n    inner = (\n      <InfiniteLoader\n        isItemLoaded={isItemLoaded}\n        itemCount={itemCount + maxToRenderPerBatch}\n        loadMoreItems={onLoadMore}\n        minimumBatchSize={maxToRenderPerBatch}\n        threshold={onEndReachedThreshold}\n      >\n        {({ onItemsRendered, ref }) => (\n          <VariableSizeList\n            ref={ref}\n            outerRef={outerRef}\n            outerElementType={outerElementType}\n            onItemsRendered={onItemsRendered}\n            width={layout.width}\n            height={layout.height}\n            itemSize={getItemSize}\n            itemCount={itemCount}\n          >\n            {Row}\n          </VariableSizeList>\n        )}\n      </InfiniteLoader>\n    );\n  }\n\n  const onLayout = React.useCallback(\n    ({\n      nativeEvent: {\n        layout: { width, height },\n      },\n    }) => {\n      setLayout({ width, height });\n    },\n    [setLayout]\n  );\n\n  return (\n    <View\n      onLayout={onLayout}\n      style={[props.style, inverted && styles.invertedContainer]}\n    >\n      {layout.width > 0 && layout.height > 0 ? inner : null}\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  invertedContainer: {\n    transform: [{ scale: -1 }],\n  },\n  invertedItem: {},\n});\n"]}